---
title: "Report"
format: pdf
tbl-cap-location: bottom
#number-sections: true
fontsize: 11pt
---
```{=latex}
\begin{center}
\begin{center}
{\LARGE \textbf{Inferential Statistics and Multivariate Regression Modeling of Housing Prices in Stockholm}} \\
\end{center}
\bigskip
\bigskip


\bigskip
\bigskip

\begin{tabular}{>{\centering\arraybackslash}p{4cm} >{\centering\arraybackslash}p{4cm} >{\centering\arraybackslash}p{5cm}}
\toprule
\textbf{Name} & \textbf{Date of Birth} & \textbf{Email} \\
\midrule
Prashant Kumar Singh & 1999-01-01 & prku7110@student.su.se \\


\bottomrule
\end{tabular}
\end{center}
```
\newpage

``` {r, echo=FALSE, results='hide'}
library(readxl)
DataSet <- read_xlsx("dataset03.xlsx")

#check for missing values
sum(is.na(DataSet)) 

#Convert categorical data columns into factors
str(DataSet)
DataSet$REGION <- factor(DataSet$REGION)
levels(DataSet$REGION)
DataSet$TYPE <- factor(DataSet$TYPE)
levels(DataSet$TYPE)
DataSet$BALCONY <- factor(DataSet$BALCONY)
levels(DataSet$BALCONY)
str(DataSet)
```



**Using a significance level of 1%, testing the hypothesis that half of the housing units in the region have a balcony.**

We want to know whether the proportion of houses having a balcony is 50%.

*Hypothesis*
\begin{align*}
H_{0}: & \; p = 0.5 \\ H_{1}: & \; p \neq 0.5
\end{align*}

-**Model Independence Assumption**: It's mentioned that Real Estate Agency collected data randomly.\newline
-**10% Condition**: 647 housing units are less than 10% of total apartments in Stockholm County. \newline
-**Success / Failure Condition**: Both\newline
np₀ = 647(0.5) = 323.5 and\newline
nq₀ = 647(0.5) = 323.5 are greater than 10; the sample is large enough.

The conditions are satisfied, so we can use a Normal model and perform a one-proportion z-test.



The null model is a Normal distribution with a mean of 0.5 and a standard deviation of \begin{align*}
SD(\hat{p}) &= \sqrt{\frac{p_0 q_0}{n}} = \sqrt{\frac{(0.5)(1-0.5)}{647}} \\
&=  0.01965703
\end{align*} 

``` {r, echo=FALSE, results='hide'}

has_bal <- sum(DataSet$BALCONY == "Yes")
n <- nrow(DataSet)

p_hat_1 <- has_bal/n
p0_1 <- 0.5

sd_p_1 <- sqrt(p0_1*(1-p0_1)/n)

z_obs_1 <- (p_hat_1-p0_1) / sd_p_1

p_value_1 <- 2*(1-pnorm(abs(z_obs_1)))

sd_1 <- (sqrt(p_hat_1*(1-p_hat_1)/n))

alpha_1<- 0.01
z_alpha_1 <- qnorm(1- alpha_1/2)
CI_lower_1 <- p_hat_1 - z_alpha_1 * sd_1
CI_upper_1 <- p_hat_1 + z_alpha_1 * sd_1

```

The observed proportion is $\hat{p}$ = `r has_bal`/`r n` =   `r p_hat_1` , so

\begin{align*}
z = \frac{\hat{p}_n - p_0}{SD(\hat{p})} = \frac{`r p_hat_1` - `r p0_1`}{`r sd_p_1`} = `r z_obs_1`
\end{align*}

$$ P = 2 . P (z \geq `r z_obs_1` ) = `r p_value_1`$$
The P-value of `r p_value_1` indicates that, if the true proportion of houses with balconies was 50%, the probability of having observed sample proportion of `r p_hat_1` is nearly zero. Therefore, we reject the null hypothesis ($H_{0}$). This provides strong evidence that the proportion of houses with a balcony is not 50%.

Also, the Confidence Interval is ( `r CI_lower_1` , `r CI_upper_1` ). With 99% confidence, the true proportion of housing units with balconies lies between 53.4% and 63.4%. The null hypothesis value (p=0.5) does not fall within this interval, further supporting the rejection of $H_{0}$.

```{r}

prop.test(x= has_bal, n=n, p=0.5, alternative = "two.sided", conf.level = 0.99)


```



**Using a significance level of 5%, testing the hypothesis that the expected size of the housing units in the region is 75 $m^{2}$.**

``` {r, echo=FALSE, results='hide'}

sample_mean_area <- mean(DataSet$AREA)
sample_sd_area <- sd(DataSet$AREA)

mu_2 <- 75
se_2 <- sample_sd_area/sqrt(n)
t_obs_2 <- (sample_mean_area - mu_2) / se_2

df_2 <- n-1

p_value_2 <- 2*pt(-abs(t_obs_2),df_2)

t_crit_2 <- qt(0.975,df_2)
CI_lower_2 <- sample_mean_area - t_crit_2 * (sample_sd_area/ sqrt(n))
CI_upper_2 <- sample_mean_area + t_crit_2 * (sample_sd_area/ sqrt(n))

```

We want to know whether average size of housing unit is 75 $m^{2}$. 

*Hypothesis*

\begin{align*}
H_{0}: & \; \text{Mean area, } \mu = 75 \\
H_{1}: & \; \text{Mean area, } \mu \neq 75
\end{align*}

From the data,

\begin{gather*}
n = `r n` \text{ houses} 
\\
\bar{y} = `r sample_mean_area` \text{ $m^{2}$} 
\\
s = `r sample_sd_area`  \text{ $m^{2}$}
\\
SE(\bar{y}) = \frac{s}{\sqrt{n}} = \frac{`r sample_sd_area`}{\sqrt{`r n`}} = `r se_2`\text{$m^{2}$}
\end{gather*}

\begin{align*}
t_{obs} = \frac{\bar{y} - \mu}{SE(\bar{y})} = \frac{`r sample_mean_area` - `r mu_2`}{`r se_2`} = `r t_obs_2` \text{ with `r df_2` df.}
\end{align*}

$t_{crit}$ (n = 647, $\alpha$ = 0.05) is in between 1.966 and 1.962 which is more than $t_{obs}$ = 1.377, hence we accept the null hypothesis.

Additionally, the Confidence Interval is ( `r CI_lower_2` , `r CI_upper_2` ). The 95% confidence interval for the true mean is between `r CI_lower_2` $m^{2}$ and `r CI_upper_2` $m^{2}$.
Since 75 $m^{2}$ falls within the confidence interval, this also suggests that the sample mean is not significantly different from 75 $m^{2}$ at the 5% significance level.


```{r}
t.test(DataSet$AREA, mu = 75, alternative = "two.sided", conf.level = 0.95)

```



**Estimating the proportion of apartments in the region through a 90% confidence interval.**

```{r, echo=FALSE, results='hide'}
prop_apartments <- sum(DataSet$TYPE == "Apartment") / n

z_alpha_half_3 <- qnorm(1-(1-0.9)/2)

sd_3 <- sqrt(prop_apartments*(1-prop_apartments)/n)

CI_lower_3 <- prop_apartments - z_alpha_half_3*sd_3

CI_upper_3 <- prop_apartments + z_alpha_half_3*sd_3
```
The observed proportion is $\hat{p}$ = `r sum(DataSet$TYPE == "Apartment")`/`r n` = `r prop_apartments`, so

\begin{align*}
SD(\hat{p}) &= \sqrt{\frac{\hat{p} \hat{q}}{n}} = \sqrt{\frac{(`r prop_apartments`)(1-`r prop_apartments`)}{`r n`}} \\
&=  `r sd_3`
\end{align*} 

Z-critical value for the 90% confidence level is `r z_alpha_half_3`. \begin{align*}
\text{CI} =& \hat{p} \pm Z \cdot \sqrt{\frac{\hat{p}(1 - \hat{p})}{n}}\frac{}{} \\
          =& `r prop_apartments` \pm (`r z_alpha_half_3`).(`r sd_3`)\\
          =& (`r CI_lower_3`,`r CI_upper_3`)
\end{align*}

With 90% confidence we can say that proportion of apartment lies between `r CI_lower_3` and `r CI_upper_3`.

```{r}
prop.test(sum(DataSet$TYPE == "Apartment"), n = n, conf.level = 0.90)

```


**Estimating the expected number of rooms of the housing units in the region through a 95% confidence interval.**

```{r, echo=FALSE, results='hide'}

mean_rooms <- mean(DataSet$ROOMS)
sd_rooms <- sd(DataSet$ROOMS)

t_crit_4 <- qt(0.975, df = 646)
se_4 <- sd_rooms/(sqrt(n))
error_margin_4 <- t_crit_4*se_4

CI_lower_4 <- mean_rooms - error_margin_4
CI_upper_4 <- mean_rooms + error_margin_4

```
\begin{gather*}
n = 647, \quad df = 646 \\
\bar{y} = `r mean_rooms`, \quad s = `r sd_rooms` \\
SE(\bar{y}) = \frac{s}{\sqrt{n}} = \frac{`r sd_rooms`}{\sqrt{647}} = `r se_4`
\end{gather*} 

t-critical value with 646 degree of freedom for the 95% confidence level is `r t_crit_4`

\begin{align*}
\text{CI} =& \bar{y} \pm t_{crit} \cdot  SE(\bar{y})\\
          =& `r mean_rooms` \pm (`r t_crit_4`).(`r se_4`)\\
          =& (`r CI_lower_4`,`r CI_upper_4`)
\end{align*} 

With 95% confidence we can say that the expected numbers of rooms lies between `r CI_lower_4` and `r CI_upper_4`.

```{r}
C.I_4 = t.test(DataSet$ROOMS,conf.level=0.95)
C.I_4$conf.int


```


**Fitting a linear regression that explains STARTING_PRICE in terms of some or all of the remaining variables.**

We need to study how the starting price ($y_i$) is affected by the remaining variables ($x_1$, $x_2$, ...). The model will then be:

\begin{align*}
y_i = \beta_0 + \beta_1 x_{1i} + \beta_2 x_{2i} + \dots + \epsilon_i \quad with \quad  \epsilon_i \overset{\text{i.i.d.}}{\sim} N(0, \sigma^2)
\end{align*}




```{r}
mult_reg = lm(STARTING_PRICE~REGION+TYPE+BALCONY+ROOMS+AREA,data=DataSet)
summary(mult_reg)
```
The Multiple regression between Region, Type, Balcony, Rooms and Area as a predictor of Starting Price is obtained as:

\begin{align}
    \text{Starting Price} = & \ -176230 + 395799 \cdot \text{REGIONNorthwest} 
    -920040 \cdot \text{REGIONSoutheast} \nonumber \\
    & + 1510987 \cdot \text{REGIONStockholm} - 1501363 \cdot \text{REGIONWest} 
    - 1172563 \cdot \text{TYPETerrace} \nonumber \\
    & + 480242 \cdot \text{TYPEVilla} - 257932 \cdot \text{BALCONYYes} 
    - 160632 \cdot \text{ROOMS} + 60419 \cdot \text{AREA}. \label{eq:mult_price_regression}
\end{align}

This equation yields R-square as 0.5628. We can improve the model by transforming one or more variables and including interaction between variables.

```{r, echo=FALSE,fig.width=4, fig.height=2.75}
# Plot residuals vs fitted values
plot(mult_reg$fitted.values, mult_reg$residuals, 
     xlab = "Fitted Values", ylab = "Residuals", 
     main = "Residuals vs Fitted Values", pch = 19, col = "blue")
abline(h = 0, col = "orange", lty = 2)
```

The residuals vs fitted graph gives us a funnel shaped pattern. Thus log transformation might yield better results.

```{r}
mult_reg2 = lm(log(STARTING_PRICE)~REGION+TYPE+ROOMS+BALCONY+AREA+AREA*ROOMS,data=DataSet)
summary(mult_reg2)
```

The modified equation is \begin{align}
\log(\text{STARTING\_PRICE}) = & \ 13.899 
+ 0.185 \cdot \text{REGIONNorthwest} 
- 0.197 \cdot \text{REGIONSoutheast} \notag \\
+ 0.377 \cdot \text{REGIONStockholm} 
& - 0.418 \cdot \text{REGIONWest} 
- 0.076 \cdot \text{TYPETerrace} 
+ 0.183 \cdot \text{TYPEVilla} \notag \\
+ 0.110 \cdot \text{ROOMS} 
& - 0.070 \cdot \text{BALCONYYes} 
+ 0.014 \cdot \text{AREA} \notag \\
& - 0.001 \cdot (\text{ROOMS} \times \text{AREA}). \label{eq:final_model}
\end{align}


```{r, echo=FALSE,fig.width=4, fig.height=2.75}
# Plot residuals vs fitted values 
plot(mult_reg2$fitted.values, mult_reg2$residuals, 
     xlab = "Fitted Values", ylab = "Residuals", 
     main = "Residuals vs Fitted Values", pch = 19, col = "blue")
abline(h = 0, col = "orange", lty = 2)
```

The Fitted vs. Residuals plot shows that the points are randomly scattered without any systematic patterns, and the variation around the estimated regression appears mostly constant. Therefore, the assumptions of linearity and variance homogeneity (constant variance) are satisfied.


```{r, echo=FALSE}
par(mfrow = c(1, 2)) 

# Plot the histogram of residuals
hist(mult_reg2$residuals, breaks = 20, 
     main = "Histogram of Residuals", 
     xlab = "Residuals", col = "lightblue", border = "black")



qqnorm(mult_reg2$residuals)
qqline(mult_reg2$residuals, col = "red")

```

The histogram of the residuals displays a bell-shaped distribution, and the data points in the QQ-plot closely follow a straight line. This indicates that the assumption of normality of the errors is valid.

Additionally, since the data were collected randomly, we can reasonably assume that the observations are independent, and no clusters or groupings are observed in the data.

This regression model yields R-square as 0.6113.

Using a 5% significance level, $\alpha$ = 0.05.

*Hypothesis* 

$H_0$ : The coefficient for a variable is zero (i.e., the variable has no effect).  

$H_1$ : The coefficient is non-zero (i.e., the variable does have an effect).

The null hypothesis is rejected if p-value < 0.05.


From the regression outputs, the statistically significant variables (with p-values < 0.05) are:
```{r, echo=FALSE}
p_values <- summary(mult_reg2)$coefficients[,4]
sig_vars <- names(p_values)[p_values < 0.05]
print(sig_vars)
```

**Predicting the starting price of these housing units in data set test.xlsx**

```{r}
test_data  = read_xlsx("test.xlsx")
test_data =data.frame(test_data)
exp(predict(mult_reg2,newdata =test_data ,interval ="prediction",level =0.95))
```

The following table presents the point prediction and interval prediction with 95% confidence level.

\begin{longtable}{cccccccccc}
\toprule
\textbf{ID} & \textbf{REGION} & \textbf{TYPE} & \textbf{ROOMS} & \textbf{AREA} & \textbf{BALCONY} & \textbf{Fit} & \textbf{Lower} & \textbf{Upper} \\
\midrule
629  & Northwest  & Apartment & 3 & 74   & Yes & 3,747,555 & 1,864,607 & 7,531,971 \\
718  & Northeast  & Apartment & 4 & 99.5 & Yes & 4,117,685 & 2,051,409 & 8,265,212 \\
1534 & Stockholm  & Apartment & 6 & 115  & Yes & 6,838,775 & 3,392,129 & 13,787,459 \\
1695 & Stockholm  & Apartment & 2 & 45   & No  & 3,350,357 & 1,672,540 & 6,711,286 \\
1864 & Stockholm  & Apartment & 1 & 29   & No  & 2,562,945 & 1,277,154 & 5,143,222 \\
2138 & Northeast  & Apartment & 2 & 47.5 & Yes & 2,207,375 & 1,100,005 & 4,429,530 \\
\bottomrule
\end{longtable}

